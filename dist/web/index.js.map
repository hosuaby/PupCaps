{"version":3,"file":"index.js","sources":["../../src/web/player.ts","../../src/web/components/player.component.vue","../../src/common/timecodes.ts","../../src/script/dynamic-css-rules.ts","../../src/web/css-processor.ts","../../src/web/caption-renderer.ts","../../src/web/index.ts"],"sourcesContent":["import {Caption} from '../common/caption';\nimport {CaptionRenderer} from './caption-renderer';\nimport {CssProcessor} from './css-processor';\n\nexport class Player {\n    public onStop = () => {};\n\n    private readonly captionsContainer: HTMLDivElement;\n    private readonly rendered: HTMLDivElement[] = [];\n    private timeoutIds: NodeJS.Timeout[] = [];\n    private displayedCaptionId = 0;\n\n    constructor(private readonly videoElem: HTMLElement,\n                private readonly captions: Caption[],\n                private readonly cssProcessor: CssProcessor,\n                renderer: CaptionRenderer) {\n        this.captionsContainer = this.videoElem.querySelector('.captions')!;\n\n        for (const caption of captions) {\n            this.rendered[caption.index] = renderer.renderCaption(caption);\n        }\n    }\n\n    public play() {\n        this.rendered.forEach(captionElem => captionElem.remove());\n\n        if (this.captions.length === 0) {\n            return;\n        }\n\n        for (let i = 0; i < this.captions.length; i++) {\n            const caption = this.captions[i];\n            const displayTimeoutId = setTimeout(() => {\n                this.displayCaption(caption.index);\n            }, caption.startTimeMs);\n\n            let hideTimeoutId: NodeJS.Timeout;\n            if (i < this.captions.length - 1) {\n                hideTimeoutId = setTimeout(() => {\n                    this.hideCaption(caption.index);\n                }, caption.endTimeMs);\n            } else {\n                hideTimeoutId = setTimeout(() => {\n                    this.hideCaption(caption.index);\n                    this.stop();\n                }, caption.endTimeMs);\n            }\n\n            this.timeoutIds.push(displayTimeoutId, hideTimeoutId);\n        }\n    }\n\n    public stop() {\n        if (this.displayedCaptionId) {\n            this.rendered[this.displayedCaptionId].remove();\n            this.displayedCaptionId = 0;\n        }\n\n        while (this.timeoutIds.length) {\n            clearTimeout(this.timeoutIds.pop());\n        }\n\n        this.onStop();\n    }\n\n    public prec() {\n        if (!this.isBeginning) {\n            let precId = this.displayedCaptionId - 1;\n            if (precId) {\n                this.displayCaption(precId);\n            } else {\n                this.hideCaption(this.displayedCaptionId)\n            }\n        }\n    }\n\n    public next() {\n        if (!this.isEnd) {\n            this.displayCaption(this.displayedCaptionId + 1);\n        }\n    }\n\n    public get isBeginning(): boolean {\n        return this.displayedCaptionId === 0;\n    }\n\n    public get isEnd(): boolean {\n        return this.displayedCaptionId === this.captions.length\n    }\n\n    private displayCaption(index: number) {\n        if (this.displayedCaptionId === index) {\n            return;     // Displayed already, do nothing\n        }\n\n        if (this.displayedCaptionId) {\n            this.rendered[this.displayedCaptionId].remove();\n        }\n\n        this.dynamicallyStyleContainers(index);\n\n        this.captionsContainer.appendChild(this.rendered[index]);\n        this.displayedCaptionId = index;\n    }\n\n    private dynamicallyStyleContainers(index: number) {\n        this.videoElem.setAttribute('class', '');\n        this.captionsContainer.setAttribute('class', 'captions');\n\n        const caption = this.captions[index - 1];\n        const captionWords = caption.words.map(word => word.rawWord);\n        this.cssProcessor.applyDynamicClasses(this.videoElem, index, caption.startTimeMs, captionWords);\n        this.cssProcessor.applyDynamicClasses(this.captionsContainer, index, caption.startTimeMs, captionWords);\n    }\n\n    private hideCaption(index: number) {\n        if (this.displayedCaptionId != index) {\n            return;     // Removed already, do nothing\n        }\n\n        this.rendered[index].remove();\n        this.displayedCaptionId = 0;\n    }\n}","<script setup lang=\"ts\">\nimport {reactive} from 'vue';\n\nconst playerState = reactive({\n  isPlaying: false,\n  isBeginning: window.Player.isBeginning,\n  isEnd: window.Player.isEnd,\n});\n\nwindow.Player.onStop = () => {\n  playerState.isPlaying = false;\n};\n\nfunction prec() {\n  window.Player.prec();\n  updateState();\n}\n\nfunction next() {\n  window.Player.next();\n  updateState();\n}\n\nfunction togglePlay() {\n  if (!playerState.isPlaying) {\n    window.Player.play();\n    playerState.isPlaying = true;\n  } else {\n    window.Player.stop();\n  }\n}\n\nfunction updateState() {\n  playerState.isBeginning = window.Player.isBeginning;\n  playerState.isEnd = window.Player.isEnd;\n}\n</script>\n\n<template>\n  <section id=\"player-controller\" class=\"section is-small\">\n    <div class=\"field has-addons has-addons-centered\">\n      <p class=\"control\">\n        <button class=\"button is-rounded\"\n                :disabled=\"playerState.isBeginning || playerState.isPlaying\"\n                @click=\"prec()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa fa-backward\"></i>\n          </span>\n          <span>Prec</span>\n        </button>\n      </p>\n      <p class=\"control\">\n        <button class=\"button\"\n                :class=\"[ playerState.isPlaying ? 'is-danger' : 'is-primary' ]\"\n                @click=\"togglePlay()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa\"\n               :class=\"[ playerState.isPlaying ? 'fa-stop' : 'fa-play' ]\">\n            </i>\n          </span>\n          <span>Play</span>\n        </button>\n      </p>\n      <p class=\"control\">\n        <button class=\"button is-rounded\"\n                :disabled=\"playerState.isEnd || playerState.isPlaying\"\n                @click=\"next()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa fa-forward\"></i>\n          </span>\n          <span>Next</span>\n        </button>\n      </p>\n    </div>\n  </section>\n</template>","export function toMillis(timecodes: string): number {\n    const parts = timecodes.split(/[:,]/).map(Number);\n\n    const hours = parts[0];\n    const minutes = parts[1];\n    const seconds = parts[2];\n    const milliseconds = parts[3];\n\n    return hours * 3_600_000    // hours to millis\n        + minutes * 60_000      // minutes to millis\n        + seconds * 1000        // second to millis\n        + milliseconds;\n}","import {toMillis} from '../common/timecodes';\n\nexport type FilterType = 'indexes' | 'timecodes' | 'words';\n\nexport interface Filter {\n    cssClass: string;\n    type: FilterType;\n    args: string[];\n}\n\nexport function normalizeTimecode(timecode: string): string {\n    const [ hh, mm, ss, ms ] = timecode.split(/[^\\d]+/);\n    return `${hh}:${mm}:${ss}.${ms}`;\n}\n\nexport abstract class AbstractDynamicCssRule {\n    protected constructor(protected readonly targetSelectors: string[],\n                          public readonly appliedCssClass: string) {\n    }\n\n    public isApplied(target: HTMLElement, captionIndex: number, timeMs: number, words: string[]): boolean {\n        let targetClasses = target.getAttribute('class')?.split(' ') || [];\n\n        for (const targetSelector of this.targetSelectors) {\n            if (targetSelector.startsWith('#')) {\n                const idSelector = targetSelector.slice(1);\n                if (target.getAttribute('id') != idSelector) {\n                    return false;\n                }\n            } else if (targetSelector.startsWith('.')) {\n                const classSelector = targetSelector.slice(1);\n                if (!targetClasses.includes(classSelector)) {\n                    return false;\n                }\n            } else {\n                throw new Error(`Unsupported target selector: '${targetSelector}'`);\n            }\n        }\n\n        return true;\n    }\n}\n\nexport class IndexesDynamicCssRule extends AbstractDynamicCssRule {\n    constructor(targetSelectors: string[],\n                appliedCssClass: string,\n                private readonly startIndexInclusive: number,\n                private readonly endIndexInclusive?: number) {\n        super(targetSelectors, appliedCssClass);\n    }\n\n    isApplied(target: HTMLElement, captionIndex: number, timeMs: number, words: string[]): boolean {\n        return super.isApplied(target, captionIndex, timeMs, words)\n            && this.startIndexInclusive <= captionIndex\n            && (this.endIndexInclusive ? this.endIndexInclusive >= captionIndex : true);\n    }\n}\n\nexport class TimecodesDynamicCssRule extends AbstractDynamicCssRule {\n    constructor(targetSelectors: string[],\n                appliedCssClass: string,\n                private readonly startTimeMsInclusive: number,\n                private readonly endTimeMsInclusive?: number) {\n        super(targetSelectors, appliedCssClass);\n    }\n\n    isApplied(target: HTMLElement, captionIndex: number, timeMs: number, words: string[]): boolean {\n        return super.isApplied(target, captionIndex, timeMs, words)\n            && this.startTimeMsInclusive <= timeMs\n            && (this.endTimeMsInclusive ? this.endTimeMsInclusive >= timeMs : true);\n    }\n}\n\nexport function createDynamicCssRule(targetSelectors: string[], filter: Filter): AbstractDynamicCssRule {\n    switch (filter.type) {\n        case 'indexes':\n            const [ startIndex, endIndex ] = filter.args.map(arg => Number(arg));\n            return new IndexesDynamicCssRule(targetSelectors, filter.cssClass, startIndex, endIndex);\n        case 'timecodes':\n            const [ startMs, endMs ] = filter.args.map(normalizeTimecode).map(toMillis);\n            return new TimecodesDynamicCssRule(targetSelectors, filter.cssClass, startMs, endMs);\n        default:\n            throw new Error(`Unknown filter type '${filter.type}'!`);\n    }\n}","import {AbstractDynamicCssRule, createDynamicCssRule, Filter, FilterType} from '../script/dynamic-css-rules';\n\nconst dynamicCssClassPattern = /^\\.pup-(\\w+)((?:-[^-]+)+)$/;\n\nexport class CssProcessor {\n    private readonly dynamicCssRules: AbstractDynamicCssRule[] = [];\n\n    constructor() {\n        for (const styleSheet of document.styleSheets) {\n            for (const styleRule of styleSheet.cssRules) {\n                const selectorText = (styleRule as CSSStyleRule).selectorText || '';\n\n                if (selectorText.includes('.pup-')) {\n                    const selectors = CssProcessor.parseSelectors(selectorText);\n                    const targetSelectors: string[] = [];\n                    let filter: Filter | null = null;\n\n                    for (const selector of selectors) {\n                        if (selector.match(dynamicCssClassPattern)) {\n                            if (filter) {\n                                throw new Error(\n                                    `Only one dynamic CSS class is allowed per style rule. \n                                    Two dynamic classes were found: .${filter.cssClass} and ${selector}`);\n                            }\n\n                            filter = CssProcessor.parseFilter(selector);\n                        } else {\n                            targetSelectors.push(selector);\n                        }\n                    }\n\n                    const rule = createDynamicCssRule(targetSelectors, filter!);\n                    this.dynamicCssRules.push(rule);\n                }\n            }\n        }\n    }\n\n    public applyDynamicClasses<T extends HTMLElement>(target: T, captionIndex: number, timeMs: number, words: string[]): T {\n        const dynamicCssClasses = this.dynamicCssClasses(target, captionIndex, timeMs, words);\n        let cssClass = target.getAttribute('class') || '';\n        dynamicCssClasses.forEach(dynamicClass => cssClass += ' ' + dynamicClass);\n        target.setAttribute('class', cssClass);\n        return target;\n    }\n\n    private dynamicCssClasses(target: HTMLElement, captionIndex: number, timeMs: number, words: string[]): string[] {\n        return this.dynamicCssRules\n            .filter(rule => rule.isApplied(target, captionIndex, timeMs, words))\n            .map(rule => rule.appliedCssClass);\n    }\n\n    static parseFilter(dynamicCssClass: string): Filter {\n        const match = dynamicCssClass.match(dynamicCssClassPattern);\n\n        if (!match) {\n            throw new Error(`CSS class ${dynamicCssClass} do not match required pattern!`);\n        }\n\n        const cssClass = dynamicCssClass.slice(1);\n        const filterType = match[1] as FilterType;\n        const filterArgs = match[2].split('-').slice(1);\n\n        return {\n            cssClass,\n            type: filterType,\n            args: filterArgs,\n        }\n    }\n\n    static parseSelectors(selectorText: string): string[] {\n        const selectors: string[] = [];\n        let currentToken = '';\n        let lastIsEscaped = false;\n\n        for (let i = 0; i < selectorText.length; i++) {\n            const char = selectorText[i];\n            if ((char === '.' || char === '#') && !lastIsEscaped) {\n                if (currentToken) {\n                    selectors.push(currentToken);\n                }\n                currentToken = char;\n            } else if (char === '\\\\') {\n                currentToken += char;\n                lastIsEscaped = true;\n            } else if (lastIsEscaped) {\n                currentToken += char;\n                lastIsEscaped = false;\n            } else {\n                currentToken += char;\n            }\n        }\n\n        if (currentToken) {\n            selectors.push(currentToken);\n        }\n\n        return selectors;\n    }\n}\n","import {Caption, Word} from '../common/caption';\nimport {CssProcessor} from './css-processor';\n\nexport class CaptionRenderer {\n    public constructor(private readonly cssProcessor: CssProcessor) {\n    }\n\n    public renderCaption(caption: Caption): HTMLDivElement {\n        const captionDiv = document.createElement('div');\n        captionDiv.setAttribute('id', `caption_${caption.index}`);\n        captionDiv.setAttribute('class', 'caption');\n\n        caption.words\n            .map(word => this.renderWord(word, caption))\n            .forEach(spanElem => captionDiv.appendChild(spanElem));\n\n        const captionWords = caption.words.map(word => word.rawWord);\n        return this.cssProcessor.applyDynamicClasses(captionDiv, caption.index, caption.startTimeMs, captionWords);\n    }\n\n    private renderWord(word: Word, caption: Caption): HTMLSpanElement {\n        const wordSpan = document.createElement('span');\n        wordSpan.textContent = word.rawWord;\n\n        let cssClass = 'word'\n        if (word.isHighlighted) {\n            cssClass += ' ' + (word.highlightClass || 'highlighted');\n        } if (word.isBeforeHighlighted) {\n            cssClass += ' before-highlighted';\n        } if (word.isAfterHighlighted) {\n            cssClass += ' after-highlighted';\n        }\n\n        wordSpan.setAttribute('class', cssClass);\n\n        return this.cssProcessor.applyDynamicClasses(wordSpan, caption.index, caption.startTimeMs, [ word.rawWord ]);\n    }\n}","import {createApp} from 'vue';\nimport {Player} from './player';\nimport PlayerComponent from './components/player.component.vue';\nimport {CssProcessor} from './css-processor';\nimport {CaptionRenderer} from './caption-renderer';\n\nwindow.ready = new Promise((resolve, reject) => {\n    window.onload = () => {\n        const videoElem = document.getElementById('video');\n        const cssProcessor = new CssProcessor();\n        const renderer = new CaptionRenderer(cssProcessor);\n        window.Player = new Player(videoElem!, window.captions, cssProcessor, renderer);\n\n        if (window.playerArgs.isPreview) {\n            createApp({})\n                .component('player', PlayerComponent)\n                .mount('#player-controller');\n        }\n\n        resolve();\n    };\n});\n"],"names":["reactive","createApp","PlayerComponent"],"mappings":"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"}