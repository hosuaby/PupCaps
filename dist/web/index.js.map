{"version":3,"file":"index.js","sources":["../../src/web/renderer.ts","../../src/web/player.ts","../../src/web/components/player.component.vue","../../src/web/index.ts"],"sourcesContent":["import {Caption, Word} from '../common/caption';\n\nfunction renderWord(word: Word): HTMLSpanElement {\n    const wordSpan = document.createElement('span');\n    wordSpan.textContent = word.rawWord;\n\n    let cssClass = 'word'\n    if (word.isHighlighted) {\n        cssClass += ' ' + (word.highlightClass || 'highlighted');\n    } if (word.isBeforeHighlighted) {\n        cssClass += ' before-highlighted';\n    } if (word.isAfterHighlighted) {\n        cssClass += ' after-highlighted';\n    }\n\n    wordSpan.setAttribute('class', cssClass);\n\n    return wordSpan;\n}\n\nexport function renderCaption(caption: Caption): HTMLDivElement {\n    const captionDiv = document.createElement('div');\n    captionDiv.setAttribute('id', `caption_${caption.index}`);\n    captionDiv.setAttribute('class', 'caption');\n\n    caption.words\n        .map(renderWord)\n        .forEach(spanElem => captionDiv.appendChild(spanElem));\n\n    return captionDiv;\n}","import {Caption} from '../common/caption';\nimport {renderCaption} from './renderer';\n\nexport class Player {\n    public onStop = () => {};\n\n    private index = 0;\n    private readonly captionsContainer: Element;\n    private readonly rendered: HTMLDivElement[] = [];\n    private timeoutIds: NodeJS.Timeout[] = [];\n    private displayedCaptionId: number | null = null;\n\n    constructor(private readonly videoElem: HTMLElement,\n                private readonly captions: Caption[]) {\n        this.captionsContainer = this.videoElem.querySelector('.captions')!;\n\n        for (const caption of captions) {\n            this.rendered[caption.index] = renderCaption(caption);\n        }\n    }\n\n    public play() {\n        this.index = 0;\n        this.rendered.forEach(captionElem => captionElem.remove());\n\n        if (this.captions.length === 0) {\n            return;\n        }\n\n        for (let i = 0; i < this.captions.length; i++) {\n            const caption = this.captions[i];\n            const displayTimeoutId = setTimeout(() => {\n                this.displayCaption(caption.index);\n            }, caption.startTimeMs);\n\n            let hideTimeoutId: NodeJS.Timeout;\n            if (i < this.captions.length - 1) {\n                hideTimeoutId = setTimeout(() => {\n                    this.hideCaption(caption.index);\n                }, caption.endTimeMs);\n            } else {\n                hideTimeoutId = setTimeout(() => {\n                    this.hideCaption(caption.index);\n                    this.stop();\n                }, caption.endTimeMs);\n            }\n\n            this.timeoutIds.push(displayTimeoutId, hideTimeoutId);\n        }\n    }\n\n    public stop() {\n        if (this.displayedCaptionId) {\n            this.rendered[this.displayedCaptionId].remove();\n            this.displayedCaptionId = null;\n        }\n\n        while (this.timeoutIds.length) {\n            clearTimeout(this.timeoutIds.pop());\n        }\n\n        this.index = 0;\n        this.onStop();\n    }\n\n    public prec() {\n        if (!this.isBeginning) {\n            const oldCaptionElem = this.rendered[this.index];\n            oldCaptionElem.remove();\n            this.index--;\n\n            if (!this.isBeginning) {\n                const newCaptionElem = this.rendered[this.index]\n                this.captionsContainer.appendChild(newCaptionElem);\n            }\n        }\n    }\n\n    public next() {\n        if (!this.isEnd) {\n            if (this.index) {\n                const oldCaptionElem = this.rendered[this.index];\n                oldCaptionElem.remove();\n            }\n\n            this.index++;\n            const newCaptionElem = this.rendered[this.index]\n            this.captionsContainer.appendChild(newCaptionElem);\n        }\n    }\n\n    public get isBeginning(): boolean {\n        return this.index === 0;\n    }\n\n    public get isEnd(): boolean {\n        return this.index === this.captions.length\n    }\n\n    private displayCaption(index: number) {\n        if (this.displayedCaptionId === index) {\n            return;     // Displayed already, do nothing\n        }\n\n        if (this.displayedCaptionId) {\n            this.rendered[this.displayedCaptionId].remove();\n        }\n\n        this.captionsContainer.appendChild(this.rendered[index]);\n        this.displayedCaptionId = index;\n    }\n\n    private hideCaption(index: number) {\n        if (this.displayedCaptionId != index) {\n            return;     // Removed already, do nothing\n        }\n\n        this.rendered[index].remove();\n        this.displayedCaptionId = null;\n    }\n}","<script setup lang=\"ts\">\nimport {reactive} from 'vue';\n\nconst playerState = reactive({\n  isPlaying: false,\n  isBeginning: window.Player.isBeginning,\n  isEnd: window.Player.isEnd,\n});\n\nwindow.Player.onStop = () => {\n  playerState.isPlaying = false;\n};\n\nfunction prec() {\n  window.Player.prec();\n  updateState();\n}\n\nfunction next() {\n  window.Player.next();\n  updateState();\n}\n\nfunction togglePlay() {\n  if (!playerState.isPlaying) {\n    window.Player.play();\n    playerState.isPlaying = true;\n  } else {\n    window.Player.stop();\n  }\n}\n\nfunction updateState() {\n  playerState.isBeginning = window.Player.isBeginning;\n  playerState.isEnd = window.Player.isEnd;\n}\n</script>\n\n<template>\n  <section id=\"player-controller\" class=\"section is-small\">\n    <div class=\"field has-addons has-addons-centered\">\n      <p class=\"control\">\n        <button class=\"button is-rounded\"\n                :disabled=\"playerState.isBeginning || playerState.isPlaying\"\n                @click=\"prec()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa fa-backward\"></i>\n          </span>\n          <span>Prec</span>\n        </button>\n      </p>\n      <p class=\"control\">\n        <button class=\"button\"\n                :class=\"[ playerState.isPlaying ? 'is-danger' : 'is-primary' ]\"\n                @click=\"togglePlay()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa\"\n               :class=\"[ playerState.isPlaying ? 'fa-stop' : 'fa-play' ]\">\n            </i>\n          </span>\n          <span>Play</span>\n        </button>\n      </p>\n      <p class=\"control\">\n        <button class=\"button is-rounded\"\n                :disabled=\"playerState.isEnd || playerState.isPlaying\"\n                @click=\"next()\">\n          <span class=\"icon is-small\">\n            <i class=\"fa fa-forward\"></i>\n          </span>\n          <span>Next</span>\n        </button>\n      </p>\n    </div>\n  </section>\n</template>","import {createApp} from 'vue';\nimport {Player} from './player';\nimport PlayerComponent from './components/player.component.vue';\n\nwindow.ready = new Promise((resolve, reject) => {\n    window.onload = () => {\n        const videoElem = document.getElementById('video');\n        window.Player = new Player(videoElem!, window.captions);\n\n        if (window.playerArgs.isPreview) {\n            createApp({})\n                .component('player', PlayerComponent)\n                .mount('#player-controller');\n        }\n\n        resolve();\n    };\n});\n"],"names":["reactive","createApp","PlayerComponent"],"mappings":"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"}